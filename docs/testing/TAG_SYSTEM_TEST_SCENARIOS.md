# タグシステムMVP 動作確認シナリオ仕様書

## 目的
タグシステムMVPの動作確認を行い、主要なユースケースが正しく実装されているかを検証する。

## テスト環境
- **デバイス**: iOS / Android実機
- **ビルド**: Debug / Release
- **アカウント**: 新規ユーザー / 既存ユーザー

---

## テストシナリオ一覧

| ID | シナリオ名 | 優先度 | 所要時間 |
|----|-----------|--------|----------|
| TS-01 | 初回ログイン時のシステムタグ初期化 | 高 | 3分 |
| TS-02 | プロフィール画面でタグを付ける | 高 | 5分 |
| TS-03 | マイタグ一覧の表示と遷移 | 高 | 5分 |
| TS-04 | カスタムタグの作成 | 高 | 5分 |
| TS-05 | タグ詳細画面の機能確認 | 中 | 5分 |
| TS-06 | 複数タグの付与と削除 | 中 | 5分 |
| TS-07 | タグのリアルタイム更新 | 中 | 5分 |
| TS-08 | フォロー外のユーザーへのタグ付け | 中 | 3分 |
| TS-09 | タグ設定の変更 | 低 | 3分 |
| TS-10 | データ永続化の確認 | 高 | 3分 |

**合計所要時間**: 約42分

---

## 事前準備

### テストアカウント準備
```
アカウント1 (テスター):
- ユーザー名: tester_user
- 用途: タグ付けする側

アカウント2 (ターゲット1):
- ユーザー名: target_user_1
- 関係: フォロー中

アカウント3 (ターゲット2):
- ユーザー名: target_user_2
- 関係: フォローしていない

アカウント4 (ターゲット3):
- ユーザー名: target_user_3
- 関係: フォロワー（相互フォロー外）
```

### チェックリスト
- [ ] Firestoreセキュリティルールがデプロイされている
- [ ] アプリが最新ビルドである
- [ ] テストアカウントが準備されている
- [ ] ネットワーク接続が安定している

---

# テストシナリオ詳細

---

## TS-01: 初回ログイン時のシステムタグ初期化

### 目的
新規ユーザーがログインした際に、システムタグが自動的に作成されることを確認する。

### 前提条件
- 新規アカウントでログインする
- または既存アカウントでタグを全削除した状態

### テスト手順

#### 1. アプリ起動とログイン
```
操作:
1. アプリを起動
2. 新規アカウントでログイン/サインアップ
3. プロフィール作成を完了

期待結果:
✓ ログインが成功する
✓ ホーム画面が表示される
```

#### 2. マイタグ画面の確認
```
操作:
1. 画面下部の「プロフィール」タブをタップ
2. 「設定」セクションの「🏷️ マイタグ」をタップ

期待結果:
✓ マイタグ一覧画面が表示される
✓ システムタグセクションに以下の6つのタグが表示される:
  - ✨ 推し (優先度: ⭐⭐⭐⭐⭐)
  - ⭐ フレンド (優先度: ⭐⭐⭐⭐)
  - 👨‍👩‍👧‍👦 家族 (優先度: ⭐⭐⭐⭐⭐)
  - 💼 仕事 (優先度: ⭐⭐⭐)
  - 👀 気になる (優先度: ⭐⭐)
  - 🚫 スキップ (優先度: ⭐)
✓ 各タグの人数が「0人」と表示される
```

#### 3. Firestoreデータの確認（オプション）
```
Firebase Console:
1. Firestore Databaseを開く
2. users/{userId}/tags コレクションを確認

期待結果:
✓ 6つのシステムタグドキュメントが存在する
✓ 各タグのisSystemTagがtrueである
✓ userCountが0である
```

### 合格基準
- [ ] システムタグ6種が全て表示される
- [ ] 各タグの情報（アイコン、名前、優先度）が正しい
- [ ] 初期状態で人数が0人である

### 不具合時の確認事項
- [ ] ログが正常に出力されているか
- [ ] Firestoreルールでエラーが発生していないか
- [ ] ネットワークエラーが発生していないか

---

## TS-02: プロフィール画面でタグを付ける

### 目的
他のユーザーのプロフィール画面からタグを付与・削除できることを確認する。

### 前提条件
- TS-01が完了している
- target_user_1をフォローしている

### テスト手順

#### 1. ユーザープロフィールを開く
```
操作:
1. ホーム画面でtarget_user_1を検索
2. プロフィールをタップ

期待結果:
✓ target_user_1のプロフィールが表示される
✓ フォローボタンが「フォロー中」と表示されている
✓ フォローボタンの右に🏷️アイコンのボタンがある
✓ ユーザー名の下にタグアイコンは表示されていない（まだタグ未設定）
```

#### 2. タグ選択シートを開く
```
操作:
1. 🏷️ボタンをタップ

期待結果:
✓ ボトムシートが表示される
✓ タイトルが「タグを選択」である
✓ システムタグ6種が全て表示される
✓ 全てのタグが未選択状態（☐）である
✓ 下部に「➕ 新しいタグを作成」ボタンがある
```

#### 3. 「フレンド」タグを付ける
```
操作:
1. 「⭐ フレンド」をタップ

期待結果:
✓ タップしたタグがアニメーション付きで選択状態になる
✓ チェックマーク（✅）が表示される
✓ タグアイコンの背景色が変わる（薄い青）
```

#### 4. シートを閉じる
```
操作:
1. シートの外側をタップ、または×ボタンをタップ

期待結果:
✓ シートが閉じる
✓ プロフィール画面に戻る
✓ ユーザー名の下に⭐アイコンが表示される
✓ 🏷️ボタンの背景色が青くなる（タグ付き状態を示す）
```

#### 5. 複数タグを追加
```
操作:
1. 🏷️ボタンを再度タップ
2. 「💼 仕事」をタップ
3. シートを閉じる

期待結果:
✓ ユーザー名の下に⭐💼の2つのアイコンが表示される
✓ アイコンは優先度順（フレンド→仕事）に並んでいる
```

#### 6. タグを削除
```
操作:
1. 🏷️ボタンをタップ
2. 「⭐ フレンド」を再度タップ（トグルオフ）
3. シートを閉じる

期待結果:
✓ フレンドタグのチェックが外れる（☐）
✓ シートを閉じると💼アイコンのみ表示される
```

### 合格基準
- [ ] タグ選択シートが正常に開く
- [ ] タグの付与・削除がリアルタイムに反映される
- [ ] タグアイコンが正しく表示される
- [ ] 複数タグの付与ができる

### 不具合時の確認事項
- [ ] タグボタンが反応しない → z-indexやタップ領域を確認
- [ ] シートが開かない → showModalBottomSheetのエラーを確認
- [ ] タグが反映されない → Firestoreへの書き込み確認

---

## TS-03: マイタグ一覧の表示と遷移

### 目的
マイタグ一覧画面が正しく表示され、各画面への遷移が正常に動作することを確認する。

### 前提条件
- TS-02が完了している
- target_user_1に「💼 仕事」タグが付いている

### テスト手順

#### 1. マイタグ画面を開く
```
操作:
1. プロフィールタブをタップ
2. 「🏷️ マイタグ」をタップ

期待結果:
✓ マイタグ一覧画面が表示される
✓ 画面タイトルが「マイタグ」である
✓ 「システムタグ」セクションが表示される
✓ 「カスタムタグ」セクションが表示される
```

#### 2. システムタグの表示確認
```
期待結果:
✓ 6つのシステムタグが優先度順に表示される
  1. ✨ 推し (⭐⭐⭐⭐⭐)
  2. 👨‍👩‍👧‍👦 家族 (⭐⭐⭐⭐⭐)
  3. ⭐ フレンド (⭐⭐⭐⭐)
  4. 💼 仕事 (⭐⭐⭐)
  5. 👀 気になる (⭐⭐)
  6. 🚫 スキップ (⭐)
✓ 各タグに正しいアイコンと名前が表示される
✓ 「💼 仕事」の人数が「1人」と表示される
✓ その他のタグは「0人」と表示される
✓ TL表示、通知ONなどの設定状態が表示される
```

#### 3. カスタムタグセクションの確認
```
期待結果:
✓ 「カスタムタグ」の見出しの右に「作成」ボタンがある
✓ カスタムタグがない場合、以下のメッセージが表示される:
  「カスタムタグを作成して
   自分だけの整理方法を見つけよう」
```

#### 4. タグ詳細画面への遷移
```
操作:
1. 「💼 仕事」タグをタップ

期待結果:
✓ タグ詳細画面に遷移する
✓ タイトルに「💼 仕事」と表示される
✓ 後で確認（TS-05で詳細テスト）
✓ 戻るボタンでマイタグ一覧に戻れる
```

#### 5. 他のタグの確認
```
操作:
1. 各システムタグを順番にタップして詳細画面を確認
2. 戻るボタンで戻る

期待結果:
✓ 全てのタグで詳細画面が開く
✓ 人数が0人のタグは空の状態を示すメッセージが表示される
✓ 遷移がスムーズである
```

### 合格基準
- [ ] システムタグ6種が正しく表示される
- [ ] タグの人数が正確である
- [ ] タグ詳細画面への遷移が正常
- [ ] UI/UXが直感的である

### 不具合時の確認事項
- [ ] 人数カウントが不正確 → Firestoreのカウント処理を確認
- [ ] タグが表示されない → StreamBuilderのエラーを確認
- [ ] 遷移が失敗する → Navigator.pushのエラーログを確認

---

## TS-04: カスタムタグの作成

### 目的
ユーザーがカスタムタグを作成できることを確認する。

### 前提条件
- TS-03が完了している

### テスト手順

#### 1. タグ作成画面を開く
```
操作:
1. マイタグ画面で「➕ 作成」ボタンをタップ
  （カスタムタグセクションの右上）

期待結果:
✓ タグ作成画面が表示される
✓ タイトルが「新しいタグを作成」である
✓ 右上に「作成」ボタンがある
✓ プレビューエリアが表示される
✓ 以下の入力欄がある:
  - タグ名入力欄
  - アイコン選択エリア
  - カラー選択エリア
  - 優先度選択エリア
```

#### 2. プレビューの確認
```
期待結果:
✓ プレビューエリアに以下が表示される:
  - デフォルトアイコン「✨」（大サイズ）
  - プレースホルダー「タグ名」
  - 優先度星3つ（デフォルト）
✓ プレビューの背景色がデフォルトカラー（紫）の薄い色
```

#### 3. タグ名を入力
```
操作:
1. タグ名入力欄をタップ
2. 「ゲーム友達」と入力

期待結果:
✓ キーボードが表示される
✓ 入力した文字がリアルタイムでプレビューに反映される
✓ プレビューのテキストが「ゲーム友達」に変わる
✓ 文字数カウンターが表示される（例: 5/20）
```

#### 4. アイコンを選択
```
操作:
1. アイコン選択エリアをスクロール
2. 「🎮」をタップ

期待結果:
✓ 24種類のアイコンが表示される
✓ タップしたアイコンに青い枠が付く
✓ プレビューのアイコンが「🎮」に変わる
✓ 以前選択していたアイコンの枠が外れる
```

#### 5. カラーを選択
```
操作:
1. カラー選択エリアから紫色をタップ

期待結果:
✓ 12色のカラーパレットが表示される
✓ タップした色に✓マークが付く
✓ プレビューの背景色が紫系に変わる
```

#### 6. 優先度を選択
```
操作:
1. 優先度「4」をタップ

期待結果:
✓ 1〜5の優先度ボタンが表示される
✓ タップした「4」が青くハイライトされる
✓ プレビューの星が4つになる
✓ 以前選択していた優先度のハイライトが外れる
```

#### 7. タグを作成
```
操作:
1. 右上の「作成」ボタンをタップ

期待結果:
✓ タグ作成画面が閉じる
✓ マイタグ一覧画面に戻る
✓ スナックバーに「🎮 ゲーム友達 を作成しました」と表示される
✓ カスタムタグセクションに「🎮 ゲーム友達」が追加される
✓ 優先度が⭐⭐⭐⭐（4つ）と表示される
✓ 人数が「0人」と表示される
```

#### 8. 作成したタグの確認
```
操作:
1. target_user_1のプロフィールを開く
2. 🏷️ボタンをタップ

期待結果:
✓ タグ選択シートに「🎮 ゲーム友達」が表示される
✓ システムタグの後に表示される
✓ タップして選択できる
```

### 合格基準
- [ ] カスタムタグが正常に作成できる
- [ ] プレビューがリアルタイムで更新される
- [ ] 作成したタグがタグ選択シートに表示される
- [ ] アイコン、色、優先度が正しく反映される

### エッジケースのテスト
```
テストケース1: タグ名なしで作成
操作: タグ名を空欄のまま「作成」をタップ
期待結果: エラーメッセージ「タグ名を入力してください」が表示される

テストケース2: 20文字以上の入力
操作: 21文字以上のタグ名を入力
期待結果: 20文字でカットされる

テストケース3: 同じ名前のタグ
操作: 既存と同じ名前のタグを作成
期待結果: 作成できる（名前の重複は許可）
```

### 不具合時の確認事項
- [ ] プレビューが更新されない → useStateの動作確認
- [ ] 作成ボタンが反応しない → バリデーション処理の確認
- [ ] Firestoreエラー → セキュリティルールの確認

---

## TS-05: タグ詳細画面の機能確認

### 目的
タグ詳細画面で、タグ付けされたユーザーの一覧表示と設定変更が正常に動作することを確認する。

### 前提条件
- TS-02が完了している
- target_user_1に「💼 仕事」タグが付いている
- target_user_2に「💼 仕事」タグが付いている

### テスト手順

#### 1. タグ詳細画面を開く
```
操作:
1. マイタグ画面で「💼 仕事」をタップ

期待結果:
✓ タグ詳細画面が表示される
✓ タイトルに「💼 仕事」と表示される
✓ 右上に設定アイコン（⚙️）がない（システムタグのため）
```

#### 2. 設定セクションの確認
```
期待結果:
✓ 「設定」セクションが表示される
✓ 2つのトグル設定が並んでいる:
  - [✓ タイムラインに表示]
  - [✓ 新しい投稿を通知]
✓ 両方ともデフォルトでONになっている
✓ トグルが青色で表示されている
```

#### 3. タイムライン表示設定の変更
```
操作:
1. 「タイムラインに表示」をタップ

期待結果:
✓ トグルがOFFになる
✓ 背景色がグレーに変わる
✓ チェックマークが外れる
✓ 再度タップするとONに戻る
```

#### 4. 通知設定の変更
```
操作:
1. 「新しい投稿を通知」をタップ

期待結果:
✓ トグルがOFFになる
✓ 背景色がグレーに変わる
✓ 再度タップするとONに戻る
```

#### 5. タグ付けユーザー一覧の確認
```
期待結果:
✓ 「タグ付けされたユーザー (2人)」と表示される
✓ target_user_1とtarget_user_2が表示される
✓ 各ユーザーに以下の情報が表示される:
  - プロフィール画像
  - ユーザー名
  - @ユーザーID
  - 右向き矢印アイコン
```

#### 6. ユーザープロフィールへの遷移
```
操作:
1. target_user_1をタップ

期待結果:
✓ target_user_1のプロフィール画面に遷移する
✓ 🏷️ボタンに青色の背景がある（タグ付き状態）
✓ ユーザー名の下に💼アイコンが表示される
✓ 戻るボタンでタグ詳細画面に戻れる
```

#### 7. 空のタグの確認
```
操作:
1. マイタグ画面に戻る
2. 「👀 気になる」（0人）をタップ

期待結果:
✓ タグ詳細画面が表示される
✓ 中央に以下が表示される:
  - 大きな👀アイコン
  - 「『気になる』タグがついた
     ユーザーはまだいません」
✓ ユーザー一覧は表示されない
```

### 合格基準
- [ ] タグ付けユーザーが正しく表示される
- [ ] 設定トグルが正常に動作する
- [ ] ユーザープロフィールへの遷移が正常
- [ ] 空のタグで適切なメッセージが表示される

### 不具合時の確認事項
- [ ] ユーザーが表示されない → Firestoreクエリを確認
- [ ] トグルが動作しない → updateTag処理を確認
- [ ] 遷移が失敗する → getUserByUserIdのエラー確認

---

## TS-06: 複数タグの付与と削除

### 目的
一人のユーザーに複数のタグを付与し、個別に削除できることを確認する。

### 前提条件
- target_user_3が存在する

### テスト手順

#### 1. 3つのタグを付ける
```
操作:
1. target_user_3のプロフィールを開く
2. 🏷️ボタンをタップ
3. 以下のタグを順番に選択:
   - ⭐ フレンド
   - 💼 仕事
   - 🎮 ゲーム友達

期待結果:
✓ 各タグをタップするごとに✅が表示される
✓ 3つすべてが選択状態になる
```

#### 2. プロフィールでの表示確認
```
操作:
1. シートを閉じる

期待結果:
✓ ユーザー名の下に3つのタグアイコンが表示される
✓ 優先度順に並んでいる:
  1. 🎮 (優先度4)
  2. ⭐ (優先度4)
  3. 💼 (優先度3)
✓ ただし、UIは最大3つまで表示される
```

#### 3. 特定のタグを削除
```
操作:
1. 🏷️ボタンを再度タップ
2. 「💼 仕事」のチェックを外す
3. シートを閉じる

期待結果:
✓ プロフィールに🎮⭐のみ表示される
✓ 💼アイコンが消える
```

#### 4. マイタグ画面での反映確認
```
操作:
1. マイタグ画面を開く
2. 「💼 仕事」タグをタップ

期待結果:
✓ 「💼 仕事」の人数が「1人」になっている（target_user_1のみ）
✓ タグ詳細画面にtarget_user_3が表示されない
```

#### 5. すべてのタグを削除
```
操作:
1. target_user_3のプロフィールに戻る
2. 🏷️ボタンをタップ
3. 残りのタグ（⭐🎮）を全て外す
4. シートを閉じる

期待結果:
✓ ユーザー名の下にタグアイコンが表示されなくなる
✓ 🏷️ボタンの背景色がグレーに戻る（タグなし状態）
```

### 合格基準
- [ ] 複数タグの同時選択ができる
- [ ] タグの優先度順に表示される
- [ ] 個別にタグを削除できる
- [ ] カウントが正確に更新される

---

## TS-07: タグのリアルタイム更新

### 目的
複数デバイス間でタグ情報がリアルタイムに同期されることを確認する。

### 前提条件
- 同じアカウントで2つのデバイスにログインしている
- または、1つのデバイスでアプリを再起動する

### テスト手順

#### 1. デバイス1でタグを追加
```
操作:
【デバイス1】
1. target_user_1のプロフィールを開く
2. 🏷️ボタンで「✨ 推し」タグを追加

期待結果（デバイス1）:
✓ タグが即座に反映される
✓ ✨アイコンが表示される
```

#### 2. デバイス2で確認
```
操作:
【デバイス2】
1. マイタグ画面を開く（既に開いている場合はそのまま）

期待結果（デバイス2）:
✓ 「✨ 推し」の人数が自動的に「1人」に更新される
✓ リフレッシュ不要で更新される（StreamBuilderの効果）
```

#### 3. デバイス2でタグを削除
```
操作:
【デバイス2】
1. target_user_1のプロフィールを開く
2. 🏷️ボタンで「✨ 推し」タグを削除

期待結果（デバイス2）:
✓ タグが即座に消える
```

#### 4. デバイス1で確認
```
期待結果（デバイス1）:
✓ マイタグ画面の「✨ 推し」が「0人」に戻る
✓ target_user_1のプロフィールから✨が消える
```

### 合格基準
- [ ] 両デバイスで変更が同期される
- [ ] 同期が5秒以内に完了する
- [ ] データの不整合が発生しない

### 単一デバイスでのテスト（代替手段）
```
操作:
1. タグを追加
2. アプリを完全に終了
3. アプリを再起動
4. マイタグ画面を確認

期待結果:
✓ タグが保持されている
✓ 人数が正確である
```

---

## TS-08: フォロー外のユーザーへのタグ付け

### 目的
フォローしていないユーザーにもタグを付けられることを確認する（フォロー独立性）。

### 前提条件
- target_user_2をフォローしていない

### テスト手順

#### 1. フォロー外ユーザーのプロフィールを開く
```
操作:
1. 検索でtarget_user_2を探す
2. プロフィールをタップ

期待結果:
✓ プロフィールが表示される
✓ フォローボタンが「フォロー」（フォロー中ではない）
✓ 🏷️ボタンが表示されている
```

#### 2. タグを付ける
```
操作:
1. 🏷️ボタンをタップ
2. 「👀 気になる」を選択
3. シートを閉じる

期待結果:
✓ タグが正常に付与される
✓ 👀アイコンが表示される
✓ フォロー状態は変わらない（「フォロー」のまま）
```

#### 3. マイタグ画面で確認
```
操作:
1. マイタグ → 「👀 気になる」をタップ

期待結果:
✓ target_user_2が表示される
✓ ユーザー名の下に「フォローしていません」などの表記はない
  （タグはフォロー状態と独立）
```

#### 4. フォロー後も維持されることを確認
```
操作:
1. target_user_2のプロフィールで「フォロー」をタップ

期待結果:
✓ フォロー状態になる
✓ 👀タグは維持される（消えない）
✓ 追加で他のタグも付けられる
```

### 合格基準
- [ ] フォロー外のユーザーにタグを付けられる
- [ ] フォロー状態の変更でタグが消えない
- [ ] タグとフォローが完全に独立している

---

## TS-09: タグ設定の変更

### 目的
タグの設定（タイムライン表示、通知）を変更できることを確認する。

### 前提条件
- 「💼 仕事」タグに1人以上ユーザーがいる

### テスト手順

#### 1. 設定の初期状態確認
```
操作:
1. マイタグ → 「💼 仕事」をタップ

期待結果:
✓ 「タイムラインに表示」がON
✓ 「新しい投稿を通知」がON
```

#### 2. タイムライン表示をOFFにする
```
操作:
1. 「タイムラインに表示」をタップしてOFFにする

期待結果:
✓ トグルがOFFになる
✓ 背景色がグレーになる
✓ Firestoreに即座に反映される
```

#### 3. 設定の永続化確認
```
操作:
1. タグ詳細画面を閉じる
2. 再度「💼 仕事」を開く

期待結果:
✓ 「タイムラインに表示」がOFFのまま
✓ 設定が保存されている
```

#### 4. 通知設定をOFFにする
```
操作:
1. 「新しい投稿を通知」をタップしてOFFにする
2. タグ詳細画面を閉じる
3. マイタグ一覧に戻る

期待結果:
✓ 「💼 仕事」タグのカードに設定状態が反映される
  （TL表示：OFF、通知：OFFのインジケーター）
```

### 合格基準
- [ ] 設定の変更が即座に反映される
- [ ] 設定が永続化される
- [ ] マイタグ一覧にも設定状態が表示される

---

## TS-10: データ永続化の確認

### 目的
タグデータがアプリ再起動後も保持されることを確認する。

### 前提条件
- 複数のタグとユーザーが設定されている

### テスト手順

#### 1. 現在の状態を記録
```
準備:
- マイタグ画面のスクリーンショットを撮る
- 各タグの人数をメモする
  例:
  - ✨ 推し: 2人
  - ⭐ フレンド: 3人
  - 💼 仕事: 1人
  - 🎮 ゲーム友達: 1人
```

#### 2. アプリを完全終了
```
操作:
【iOS】
1. ホームボタンをダブルクリック（またはスワイプアップ）
2. アプリを上にスワイプして終了

【Android】
1. 最近のアプリ一覧を表示
2. アプリを左右にスワイプして終了

期待結果:
✓ アプリが完全に終了する
```

#### 3. アプリを再起動
```
操作:
1. アプリアイコンをタップして起動
2. ログイン画面が表示されたらログイン

期待結果:
✓ アプリが正常に起動する
✓ ホーム画面が表示される
```

#### 4. マイタグ画面を確認
```
操作:
1. プロフィール → マイタグ を開く

期待結果:
✓ 全てのタグが保持されている
✓ 各タグの人数が起動前と一致する
✓ カスタムタグも保持されている
```

#### 5. タグ詳細の確認
```
操作:
1. 各タグの詳細画面を開く
2. タグ付けユーザー一覧を確認

期待結果:
✓ すべてのユーザーが正しく表示される
✓ 設定（TL表示、通知）も保持されている
```

#### 6. プロフィールでの確認
```
操作:
1. タグ付けしたユーザーのプロフィールを開く

期待結果:
✓ タグアイコンが正しく表示される
✓ 🏷️ボタンの状態（青色背景）が正しい
```

### 合格基準
- [ ] すべてのタグが永続化されている
- [ ] タグの人数が正確である
- [ ] カスタムタグも保持されている
- [ ] タグ設定が保持されている

---

## 回帰テスト（全機能統合テスト）

### 目的
すべての機能が統合された状態で正常に動作することを確認する。

### シナリオフロー（15分）

```
1. 新規ユーザーでログイン
   → システムタグ6種が自動作成される

2. カスタムタグ「🎮 ゲーム友達」を作成
   → マイタグに追加される

3. ユーザーAをフォローしてタグ付け
   - ⭐ フレンド
   - 🎮 ゲーム友達
   → プロフィールに2つのアイコン表示

4. ユーザーB（フォロー外）にタグ付け
   - 👀 気になる
   → フォローせずにタグ付け成功

5. ユーザーC（フォロー中）にタグ付け
   - 💼 仕事
   - ⭐ フレンド
   → 複数タグ付与成功

6. マイタグ画面を確認
   - 各タグの人数が正確
   - タグ詳細で全ユーザー表示

7. タグ設定を変更
   - 「💼 仕事」のTL表示をOFF
   → 設定が保存される

8. ユーザーAのタグを削除
   - 🎮タグのみ削除
   → ⭐タグは残る

9. アプリを再起動
   → すべてのデータが保持される

10. デバイス2でログイン（オプション）
    → すべてのタグが同期される
```

### 合格基準
- [ ] すべての操作が5秒以内に完了する
- [ ] UIがフリーズしない
- [ ] データの不整合が発生しない
- [ ] エラーメッセージが表示されない

---

## パフォーマンステスト

### 目的
大量のデータでもアプリが正常に動作することを確認する。

### テストケース

#### 1. 大量タグの作成
```
準備:
- カスタムタグを20個作成

期待結果:
✓ マイタグ一覧が正常にスクロールできる
✓ 画面がもたつかない
✓ タグ選択シートで全タグが表示される
```

#### 2. 大量ユーザーへのタグ付け
```
準備:
- 「⭐ フレンド」タグを50人に付ける

期待結果:
✓ タグ詳細画面が正常にスクロールできる
✓ 読み込みに5秒以上かからない
✓ 人数カウントが正確
```

#### 3. 一人に大量タグ付け
```
準備:
- 1人のユーザーに10個のタグを付ける

期待結果:
✓ タグ選択シートで全選択状態が表示される
✓ プロフィールで優先度順に表示される（最大3つまで）
✓ スクロールで全タグが確認できる
```

---

## エラーハンドリングテスト

### 目的
ネットワークエラーやデータエラー時の動作を確認する。

### テストケース

#### 1. ネットワーク切断時
```
操作:
1. 機内モードをONにする
2. タグを付けようとする

期待結果:
✓ エラーメッセージが表示される
✓ アプリがクラッシュしない
✓ ネットワーク復帰後に再試行できる
```

#### 2. 権限エラー
```
操作:
1. Firebase Consoleでセキュリティルールを一時的に厳しくする
2. タグ操作を試みる

期待結果:
✓ 権限エラーのメッセージが表示される
✓ アプリがクラッシュしない
```

#### 3. データ不整合
```
準備:
1. Firebase Consoleで手動でタグデータを削除
2. アプリでマイタグを開く

期待結果:
✓ 空の状態を示すメッセージが表示される
✓ アプリがクラッシュしない
✓ 新規タグ作成は可能
```

---

## テスト結果記録テンプレート

```markdown
## テスト実施記録

**日時**: 2025-XX-XX XX:XX
**テスター**: [名前]
**デバイス**: [iOS/Android] [機種名] [OSバージョン]
**ビルド**: [バージョン番号]

### テスト結果サマリー

| シナリオID | 結果 | 備考 |
|-----------|------|------|
| TS-01 | ✅ PASS |  |
| TS-02 | ✅ PASS |  |
| TS-03 | ✅ PASS |  |
| TS-04 | ✅ PASS |  |
| TS-05 | ✅ PASS |  |
| TS-06 | ✅ PASS |  |
| TS-07 | ⚠️ WARN | 同期に10秒かかった |
| TS-08 | ✅ PASS |  |
| TS-09 | ✅ PASS |  |
| TS-10 | ✅ PASS |  |

### 発見された不具合

#### BUG-001: [不具合タイトル]
- **重要度**: 高/中/低
- **再現手順**:
  1. ...
  2. ...
- **期待結果**: ...
- **実際の結果**: ...
- **スクリーンショット**: [添付]

### 総合評価

- **テスト実施項目**: XX / 10
- **合格項目**: XX / 10
- **不合格項目**: XX / 10
- **総合判定**: ✅ PASS / ⚠️ WARN / ❌ FAIL

### コメント

[テスト全体の感想、気づいた点など]
```

---

## チェックリスト（テスト前確認）

### 環境準備
- [ ] Firestore Database が本番/開発環境で正しく設定されている
- [ ] セキュリティルールがデプロイされている
- [ ] アプリが最新ビルドである
- [ ] テストアカウントが準備されている

### デバイス準備
- [ ] バッテリーが50%以上ある
- [ ] ストレージに十分な空きがある
- [ ] ネットワーク接続が安定している
- [ ] 通知権限が許可されている

### データ準備
- [ ] 既存のタグデータをバックアップ（必要に応じて）
- [ ] テスト用ユーザーが3人以上いる
- [ ] フォロー関係が設定されている

---

## よくある問題と対処法

### タグが表示されない
**原因**:
- Firestoreセキュリティルールの問題
- ネットワークエラー
- データ同期の遅延

**対処法**:
1. ネットワーク接続を確認
2. アプリを再起動
3. Firebase Consoleでデータを確認
4. セキュリティルールのログを確認

### タグ選択シートが開かない
**原因**:
- UI階層の問題
- Navigator contextの問題

**対処法**:
1. コンソールログを確認
2. デバッグモードで実行
3. 他のユーザーで試す

### カウントが合わない
**原因**:
- トランザクションの失敗
- 複数デバイス間の同期タイミング

**対処法**:
1. アプリを再起動して再確認
2. Firebase Consoleで実データを確認
3. カウント再計算処理を実行（実装されている場合）

---

## 次ステップ（テスト完了後）

### 合格時
1. ✅ テスト結果レポートを作成
2. ✅ スクリーンショットを記録
3. ✅ 次フェーズの開発へ進む

### 不合格時
1. ❌ 不具合をIssueに登録
2. ❌ 優先度を設定
3. ❌ 修正後に再テスト

---

**最終更新**: 2025-10-06
**バージョン**: 1.0
