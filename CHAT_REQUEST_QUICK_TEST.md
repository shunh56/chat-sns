# チャットリクエスト機能 クイックテストガイド

## 🚀 5分でできる基本動作確認

このガイドは、チャットリクエスト機能が正常に動作しているか最短で確認するためのものです。

---

## ✅ 事前準備（1分）

### 必要なもの
- [ ] 2台のテストデバイス（または1台 + エミュレータ）
- [ ] 2つのテストアカウント
  - **ユーザーA**（リクエスト送信者）
  - **ユーザーB**（リクエスト受信者）

### 初期状態の確認
```bash
# Firestoreで確認（Firebase Console または CLI）
# A-B間にチャットリクエストが存在しないこと
# A-B間にDMルームが存在しないこと
```

---

## 📱 基本フロー（4分）

### ステップ1: リクエスト送信（30秒）
**デバイス: ユーザーA**

1. ユーザーBのプロフィール画面を開く
2. 💬 メッセージボタンをタップ
3. 「はじめまして！」と入力
4. 「送信」ボタンをタップ

**✓ 確認:**
- ✅ 「リクエストを送信しました」のメッセージが表示される
- ✅ ダイアログが閉じる

---

### ステップ2: 通知確認（30秒）
**デバイス: ユーザーB**

**✓ 確認:**
- ✅ プッシュ通知が届く
  - タイトル: ユーザーAの名前
  - 本文: "はじめまして！"

---

### ステップ3: リクエスト一覧確認（1分）

#### 送信側（ユーザーA）
1. チャットリクエスト一覧画面を開く
2. 「送信」タブを選択

**✓ 確認:**
- ✅ ユーザーBが表示される
- ✅ "送信済み" バッジが表示される
- ✅ メッセージ「はじめまして！」が表示される

#### 受信側（ユーザーB）
1. チャットリクエスト一覧画面を開く
2. 「受信」タブを確認

**✓ 確認:**
- ✅ ユーザーAが表示される
- ✅ メッセージ「はじめまして！」が表示される
- ✅ 「承認」「却下」ボタンが表示される

---

### ステップ4: リクエスト承認（1分）
**デバイス: ユーザーB**

1. 「承認」ボタンをタップ

**✓ 確認:**
- ✅ チャット画面に自動遷移
- ✅ ユーザーAとのチャット画面が表示される
- ✅ ユーザーAに「承認されました」通知が届く

---

### ステップ5: チャット動作確認（1分）
**デバイス: ユーザーB → ユーザーA**

1. 「テストメッセージ」を送信
2. ユーザーAのデバイスでメッセージを確認

**✓ 確認:**
- ✅ メッセージが送受信できる
- ✅ リアルタイムで更新される

---

## ✅ 結果判定

### ✅ 成功: 全ての確認項目にチェックが入っている
→ チャットリクエスト機能は正常に動作しています

### ⚠️ 失敗: いずれかの確認項目でエラー
→ 以下のトラブルシューティングを参照してください

---

## 🔧 トラブルシューティング

### 問題1: 「リクエストを送信できない」

**症状:**
- ダイアログが表示されない
- エラーメッセージが表示される

**確認事項:**
```
1. 既にチャットが存在していないか？
   → DM一覧を確認

2. 既にリクエストを送信していないか？
   → リクエスト一覧の「送信」タブを確認

3. ネットワークエラー？
   → インターネット接続を確認
```

**解決策:**
```dart
// Firestoreで既存データを削除
/chat_requests/{requestId} を削除
/direct_messages/{roomId} を削除（該当する場合）
```

---

### 問題2: 「通知が届かない」

**症状:**
- リクエストは送信できるが通知が届かない

**確認事項:**
```
1. 通知許可が有効か？
   → 設定 > アプリ名 > 通知 を確認

2. FCMトークンが登録されているか？
   → Firestoreの users/{userId}/fcmToken を確認

3. Firebase Consoleで FCM が有効か？
   → Firebase Console > Cloud Messaging を確認
```

**解決策:**
```
1. デバイスを再起動
2. アプリを再インストール
3. 通知許可を再設定
```

---

### 問題3: 「リクエスト一覧に表示されない」

**症状:**
- リクエストを送信したが一覧に表示されない

**確認事項:**
```
1. Firestoreにデータが保存されているか？
   → Firebase Console > Firestore を確認

2. ステータスが "pending" か？
   → status フィールドを確認

3. クエリが正しいか？
   → toUserId / fromUserId が正しいか確認
```

**解決策:**
```dart
// Firestoreで直接データを確認
/chat_requests/{requestId}
{
  "id": "...",
  "fromUserId": "ユーザーAのID",
  "toUserId": "ユーザーBのID",
  "status": "pending",
  "message": "はじめまして！",
  "createdAt": Timestamp
}
```

---

### 問題4: 「承認してもチャット画面に遷移しない」

**症状:**
- 承認ボタンをタップしてもチャット画面が開かない

**確認事項:**
```
1. エラーメッセージが表示されているか？
   → エラー内容を確認

2. DMルームが作成されているか？
   → /direct_messages/{roomId} を確認

3. ナビゲーションエラー？
   → コンソールログを確認
```

**解決策:**
```
1. アプリを再起動
2. Firestoreのデータを確認
3. ログでエラー詳細を確認
```

---

## 🔍 詳細テストが必要な場合

より詳細なテストが必要な場合は、以下のドキュメントを参照してください：

📄 **CHAT_REQUEST_TEST_GUIDE.md**
- 全テストケース（8種類）
- エラーケーステスト
- 通知機能の詳細テスト
- パフォーマンステスト

---

## 📊 テスト結果記録テンプレート

### テスト実施日時
```
日時: ____年__月__日 __:__
```

### テスト環境
```
デバイス1: ________________
OS: ______________________
アプリバージョン: __________

デバイス2: ________________
OS: ______________________
アプリバージョン: __________
```

### テスト結果
```
[ ] ステップ1: リクエスト送信 - 成功 / 失敗
[ ] ステップ2: 通知確認 - 成功 / 失敗
[ ] ステップ3: リクエスト一覧確認 - 成功 / 失敗
[ ] ステップ4: リクエスト承認 - 成功 / 失敗
[ ] ステップ5: チャット動作確認 - 成功 / 失敗
```

### 発見した問題
```
1.
2.
3.
```

### 総合評価
```
[ ] 全て成功 - 本番リリース可能
[ ] 一部失敗 - 修正が必要
[ ] 多数失敗 - 再実装が必要
```

---

## 📞 サポート

問題が解決しない場合は、以下の情報を添えて開発チームに連絡してください：

```
1. テスト環境（デバイス、OS、アプリバージョン）
2. 再現手順
3. 期待される動作
4. 実際の動作
5. エラーメッセージ（あれば）
6. スクリーンショット（あれば）
```

---

**所要時間:** 5分
**難易度:** ⭐️ 初級
**更新日:** 2025年10月9日
